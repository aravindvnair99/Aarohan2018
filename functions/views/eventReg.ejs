<% include nav.ejs %>

<head>
	<title>Event Registration Form</title>
	
</head>

<div class="container">
<div class="row"></div>
<div class="row">
    <div class="col l3"></div>
    <div class="col s12 l6">
    <div class="card">
        <form action="/reg_event" method="POST">
            <div class="card-content">
			<h4 style="color: #faae29">Event Registration</h4><br>
			<div class="input-field">
				<label>Event</label>
				<select name="nameEvent" id="nameEvent" required class="event">
					<option disabled selected></option>
					<option value="Being poirot">Being Poirot</option>
					<option value="Circuitrix">Circuitrix</option>
					<option value="Code bound">Code Bound</option>
					<option value="Espiri de corps">Esprit de Corps</option>
					<option value="Final destination">Final Destination</option>
					<option value="Kerbal space program">Kerbal Space Program</option>
					<option value="Lakshya">Lakshya</option>
					<option value="Let's ring it up">Let's ring it up</option>
					<option value="Mathermentum contour">Mathementum Contour</option>
					<option value="Mechathalon">Mechathalon</option>
					<option value="Mindsweeper">Mindsweeper</option>
					<option value="Omnium artium magister">Omnium Artium Magister</option>
					<option value="Project exhibition">Project Exhibition</option>
					<option value="Race for glory">Race for Glory</option>
					<option value="Robo cup">Robo Cup</option>
					<option value="School duels">School Duels</option>
					<option value="Sherlocked">Sherlocked</option>
					<option value="Targo">Targo</option>
					<option value="Tech roadies">Tech roadies</option>
					<option value="The sphinx quiz">The Sphinx Quiz</option>
				</select>
			</div>
			<input type="text" id="num" name="num" value="">Number of members: (max. 10)<br />
			<a href="#" id="filldetails" onclick="addFields()">Fill Details</a>
            <div class="card-action">
            <button class="btn waves-effect waves-light" type="submit" name="action" onclick="Materialize.toast('Registered', 400)">Submit
                <i class="material-icons right">send</i>
            </button>
            </div>
        </form>
    </div>
</div>
</div>
</div>
<script defer src="/__/firebase/5.5.5/firebase-app.js"></script>
	<script defer src="/__/firebase/5.5.5/firebase-firestore.js"></script>
	<script defer src="/__/firebase/init.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script>
		function initApp() {
			/*eventName = document.getElementById("event").value;*/
			eventName = "Mindsweeper";
			firebase.firestore().collection("events").doc(eventName).get().then((doc) => {
				if (doc.exists) {
					max = doc.data().Max;
					min = doc.data().Min;
					console.log(max);
					if (max == min)
						for (i = 0; i < max; i++) {
							container.appendChild(document.createTextNode("Student " + (i + 1) + " "));
							var input = document.createElement("input");
							input.type = "text";
							input.name = "student" + i;
							container.appendChild(input);
							container.appendChild(document.createElement("br"));
						}
					else
						number = max;
					return (doc.data());
				} else {
					throw new Error("Event does not exist");
				}
			}).catch((err) => {
				console.log(err);
			});
		};
		function addFields() {
			// var card = document.getElementsByName("event");
			// if (card.selectedIndex == 0) {
			// 	alert('select one answer');
			// }
			// else {
			// 	var selectedText = card.options[card.selectedIndex].value;
			// 	alert(selectedText);
			// }
			// $('.event option:selected').change(function () {
			// 	eventName = $(this).val();
			// });
			var e = document.getElementById('nameEvent');
			var eventName = e.options[e.selectedIndex].value;
			console.log(eventName);
			console.log("CHecking");
			firebase.firestore().collection("events").doc(eventName).get().then((doc) => {
				if (doc.exists) {
					max = doc.data().Max;
					min = doc.data().Min;
					console.log(max);
					if (max == min)
						for (i = 1; i <= max; i++) {
							container.appendChild(document.createTextNode("Student " + (i) + " "));
							var input = document.createElement("input");
							input.type = "text";
							input.name = i;
							container.appendChild(input);
							container.appendChild(document.createElement("br"));
						}
					else{
						number = max;
						for (i = 1; i <= max; i++) {
							container.appendChild(document.createTextNode("Student " + (i) + " "));
							var input = document.createElement("input");
							input.type = "text";
							input.name =  i;
							container.appendChild(input);
							container.appendChild(document.createElement("br"));
						}
					}
						
					return (doc.data());
				} else {
					throw new Error("Event does not exist");
				}
			}).catch((err) => {
				console.log(err);
			});
		}
		window.onload = function () {
			//initApp();
		};
	</script> 



<!--<body>
	<h3>SCHOOL REGISTRATION FORM</h3>
	<form action="/onEventReg" method="POST">
		<div class="card-content">
			<h4 style="color: #faae29;">Student Registration</h4><br>
			<div class="input-field">
				<label>Event</label>
				<select name="nameEvent" id="nameEvent" required class="event">
					<option disabled selected></option>
					<option value="Being poirot">Being Poirot</option>
					<option value="Circuitrix">Circuitrix</option>
					<option value="Code bound">Code Bound</option>
					<option value="Espiri de corps">Esprit de Corps</option>
					<option value="Final destination">Final Destination</option>
					<option value="Kerbal space program">Kerbal Space Program</option>
					<option value="Lakshya">Lakshya</option>
					<option value="Let's ring it up">Let's ring it up</option>
					<option value="Mathermentum contour">Mathementum Contour</option>
					<option value="Mechathalon">Mechathalon</option>
					<option value="Mindsweeper">Mindsweeper</option>
					<option value="Omnium artium magister">Omnium Artium Magister</option>
					<option value="Project exhibition">Project Exhibition</option>
					<option value="Race for glory">Race for Glory</option>
					<option value="Robo cup">Robo Cup</option>
					<option value="School duels">School Duels</option>
					<option value="Sherlocked">Sherlocked</option>
					<option value="Targo">Targo</option>
					<option value="Tech roadies">Tech roadies</option>
					<option value="The sphinx quiz">The Sphinx Quiz</option>
				</select>
			</div>
			<input type="text" id="num" name="num" value="">Number of members: (max. 10)<br />
			<a href="#" id="filldetails" onclick="addFields()">Fill Details</a>
			<div class="card-action">
				<button class="btn -waves-effect waves-light" type="submit" name="action">Submit
					<i class="material-icons right"></i>
				</button>
			</div>
			<div id="container" />
	</form>
</body> -->
<%include foot.ejs %>