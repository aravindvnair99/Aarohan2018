<% include nav.ejs %>
<div class="container">
	<div class="row"></div>
	<div class="row">
		<div class="col l3"></div>
		<div class="col s12 l6">
			<div class="card">
				<form action="/onEventReg" method="POST">
					<div class="card-content">
						<h4 style="color: #faae29">Event Registration</h4><br>
						<div class="input-field">
							<input id="eventName" name="eventName" value="Being poirot" type="hidden" class="validate" required>
						</div><br>
						<% include Student1.ejs %>
						<% include Student2.ejs %>
						<% include Student3.ejs %>
						<div class="card-action">
							<button class="btn waves-effect waves-light" type="submit" name="action">Submit
								<i class="material-icons right">send</i>
							</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<%include foot.ejs %>
<script>
	var db = firebase.firestore();
	function check() {
		var eventName = document.getElementById("eventName").value;
		var student1 = document.getElementById("Student1").value;
		var student2 = document.getElementById("Student2").value;
		var student3 = document.getElementById("Student3").value;
		db.collection("events").doc(eventName).collection("Students").doc(student1).get().then((doc) => {
			if (doc.exists) {
				Materialize.toast("Student already exists", 1500);
				document.getElementById("Student1").value = '';
			}
		}).catch((err) => {
			console.log(err);
		});
		db.collection("events").doc(eventName).collection("Students").doc(student2).get().then((doc) => {
			if (doc.exists) {
				Materialize.toast("Student already exists", 1500);
				document.getElementById("Student2").value = '';
			}
		}).catch((err) => {
			console.log(err);
		});
		db.collection("events").doc(eventName).collection("Students").doc(student3).get().then((doc) => {
			if (doc.exists) {
				Materialize.toast("Student already exists", 1500);
				document.getElementById("Student3").value = '';
			}
		}).catch((err) => {
			console.log(err);
		});
	}
	function checkUser() {
		if (firebase.auth().currentUser.email === "being@aarohan.org") {
			console.log("succ");
			res.redirect('/beingPoirot');
		} else {
			console.log("fail");
			res.redirect('/eventReg');
		}
	}
	window.onload = checkUser();
</script>